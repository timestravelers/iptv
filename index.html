<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>IQ-TV Smart Player</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>

<style>
:root{
  --bg:#0b0b0f;
  --panel:#14141c;
  --card:#1c1c26;
  --accent:#00bcd4;
  --text:#ffffff;
  --muted:#9aa0a6;
}

*{box-sizing:border-box}
body{
  margin:0;
  background:var(--bg);
  color:var(--text);
  font-family:Segoe UI,Roboto,sans-serif;
}
.hidden{display:none}

/* ===== LOAD SCREEN ===== */
.load-screen{
  height:100vh;
  display:flex;
  flex-direction:column;
  justify-content:center;
  align-items:center;
  gap:20px;
}
.load-screen h1{
  font-size:42px;
  letter-spacing:2px;
}
.load-box{
  background:var(--panel);
  padding:25px 40px;
  border-radius:14px;
  cursor:pointer;
  font-size:18px;
}
.load-box:hover{background:var(--card)}
.load-input{
  margin-top:15px;
}
.load-input input{
  width:320px;
  padding:10px;
  font-size:16px;
}

/* ===== APP LAYOUT ===== */
.app{
  display:flex;
  height:100vh;
}

/* ===== SIDEBAR ===== */
.sidebar{
  width:260px;
  background:var(--panel);
  display:flex;
  flex-direction:column;
}
.sidebar h2{
  padding:20px;
  margin:0;
  font-size:22px;
}
.menu{
  padding:14px 20px;
  font-size:17px;
  cursor:pointer;
}
.menu:hover,.menu.active{
  background:var(--card);
}
.clear{
  margin-top:auto;
  color:#ff7675;
}

/* ===== MAIN ===== */
.main{
  flex:1;
  display:flex;
  flex-direction:column;
}
.header{
  padding:14px 20px;
  display:flex;
  justify-content:space-between;
  align-items:center;
  border-bottom:1px solid #222;
}
.header span{color:var(--muted)}
.search input{
  background:var(--panel);
  border:none;
  color:var(--text);
  padding:8px 12px;
  font-size:16px;
}

/* ===== VIDEO ===== */
.player{
  height:420px;
  background:black;
}
.player video{
  width:100%;
  height:100%;
}

/* ===== CHANNEL GRID ===== */
.grid{
  padding:18px;
  display:grid;
  grid-template-columns:repeat(auto-fill,minmax(180px,1fr));
  gap:18px;
}
.channel{
  background:var(--card);
  padding:18px;
  border-radius:14px;
  font-size:17px;
  cursor:pointer;
}
.channel:hover{
  outline:3px solid var(--accent);
}
</style>
</head>

<body>

<!-- ===== LOAD ===== -->
<div id="load" class="load-screen hidden">
  <h1>IQ-TV</h1>
  <div class="load-box" id="fileBtn">üìÅ Upload M3U</div>
  <div class="load-box" id="urlBtn">üîó Load M3U URL</div>
  <div class="load-input hidden" id="urlBox">
    <input id="m3uUrl" placeholder="https://example.com/list.m3u">
  </div>
  <input type="file" id="fileInput" accept=".m3u,.m3u8" hidden>
</div>

<!-- ===== APP ===== -->
<div id="app" class="app hidden">
  <div class="sidebar">
    <h2>üì∫ IQ-TV</h2>
    <div class="menu active">All Channels</div>
    <div class="menu clear" id="clear">üóë Clear Playlist</div>
  </div>

  <div class="main">
    <div class="header">
      <span id="playlistName"></span>
      <div class="search">
        <input id="search" placeholder="Search channel">
      </div>
    </div>

    <div class="player" id="player">
      <div style="padding:20px">Select a channel</div>
    </div>

    <div class="grid" id="grid"></div>
  </div>
</div>

<script>
let playlist=[],filtered=[],hls=null;

const load=document.getElementById('load');
const app=document.getElementById('app');
const grid=document.getElementById('grid');
const player=document.getElementById('player');
const playlistName=document.getElementById('playlistName');

function showLoad(){load.classList.remove('hidden');app.classList.add('hidden')}
function showApp(){load.classList.add('hidden');app.classList.remove('hidden')}

/* ===== M3U PARSER ===== */
function parseM3U(t){
  const lines=t.split('\n');
  let c=null,res=[];
  lines.forEach(l=>{
    l=l.trim();
    if(l.startsWith('#EXTINF')){
      c={name:l.split(',').pop(),url:''};
    }else if(l && !l.startsWith('#') && c){
      c.url=l;res.push(c);c=null;
    }
  });
  return res;
}

/* ===== LOAD ===== */
function loadPlaylist(list,name){
  playlist=list;
  filtered=list;
  playlistName.textContent=name;
  localStorage.setItem('iqtv',JSON.stringify(list));
  localStorage.setItem('iqtv_name',name);
  showApp();
  render();
}

function render(){
  grid.innerHTML='';
  filtered.forEach(c=>{
    const d=document.createElement('div');
    d.className='channel';
    d.textContent=c.name;
    d.onclick=()=>play(c);
    grid.appendChild(d);
  });
}

/* ===== PLAYER ===== */
function play(c){
  player.innerHTML='<video id="v" controls autoplay></video>';
  const v=document.getElementById('v');
  if(hls){hls.destroy();hls=null;}

  if(v.canPlayType('application/vnd.apple.mpegurl')){
    v.src=c.url;
  }else{
    hls=new Hls();
    hls.loadSource(c.url);
    hls.attachMedia(v);
  }
  v.ondblclick=()=>v.requestFullscreen();
}

/* ===== EVENTS ===== */
document.getElementById('fileBtn').onclick=()=>fileInput.click();
fileInput.onchange=e=>{
  const r=new FileReader();
  r.onload=()=>loadPlaylist(parseM3U(r.result),e.target.files[0].name);
  r.readAsText(e.target.files[0]);
};

document.getElementById('urlBtn').onclick=()=>urlBox.classList.toggle('hidden');
m3uUrl.onchange=()=>{
  fetch(m3uUrl.value).then(r=>r.text())
  .then(t=>loadPlaylist(parseM3U(t),'Remote Playlist'));
};

document.getElementById('search').oninput=e=>{
  filtered=playlist.filter(c=>c.name.toLowerCase().includes(e.target.value.toLowerCase()));
  render();
};

document.getElementById('clear').onclick=()=>{
  localStorage.clear();
  playlist=[];filtered=[];
  grid.innerHTML='';
  player.innerHTML='<div style="padding:20px">Select a channel</div>';
  showLoad();
};

/* ===== AUTO START ===== */
const saved=localStorage.getItem('iqtv');
saved?loadPlaylist(JSON.parse(saved),localStorage.getItem('iqtv_name')):showLoad();
</script>

</body>
</html>


<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>APK STUDIO PRO - Browser Edition</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Fira+Code:wght@400;600&family=Inter:wght@400;700;900&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; background: #0a0a0b; color: #e4e4e7; }
        .code-font { font-family: 'Fira Code', monospace; }
        .custom-scrollbar::-webkit-scrollbar { width: 5px; height: 5px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: #111; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #333; border-radius: 10px; }
        .file-item:hover { background: rgba(52, 211, 153, 0.1); }
        .file-item.active { background: rgba(52, 211, 153, 0.2); border-left: 3px solid #10b981; }
        @keyframes scanline { 0% { bottom: 100%; } 100% { bottom: 0%; } }
        .scanline { height: 2px; background: rgba(16, 185, 129, 0.1); position: absolute; width: 100%; animation: scanline 4s linear infinite; pointer-events: none; }
    </style>
</head>
<body class="h-screen flex flex-col overflow-hidden relative">
    <div class="scanline"></div>
    <div id="root" class="h-full"></div>

    <script type="importmap">
    {
      "imports": {
        "react": "https://esm.sh/react@18.2.0",
        "react-dom": "https://esm.sh/react-dom@18.2.0",
        "lucide-react": "https://esm.sh/lucide-react@0.263.1"
      }
    }
    </script>

    <script type="module">
        import React, { useState, useEffect, useRef } from 'react';
        import ReactDOM from 'react-dom';
        import { 
            FileCode, Folder, File, Upload, Download, Save, 
            Search, X, Check, HardDrive, Terminal, Layers
        } from 'lucide-react';

        const App = () => {
            const [zip, setZip] = useState(null);
            const [files, setFiles] = useState([]);
            const [selectedPath, setSelectedPath] = useState(null);
            const [content, setContent] = useState('');
            const [isModified, setIsModified] = useState(false);
            const [loading, setLoading] = useState(false);
            const [search, setSearch] = useState('');

            const fileInputRef = useRef(null);

            // Load APK as Zip
            const handleUpload = async (e) => {
                const file = e.target.files[0];
                if (!file) return;
                setLoading(true);
                try {
                    const loadedZip = await JSZip.loadAsync(file);
                    setZip(loadedZip);
                    const fileList = Object.keys(loadedZip.files).sort();
                    setFiles(fileList);
                    setSelectedPath(null);
                    setContent('');
                    alert("APK Berhasil Dimuat! Silahkan pilih file untuk diedit.");
                } catch (err) {
                    alert("Error: Gagal memuat file APK.");
                } finally {
                    setLoading(false);
                }
            };

            // Read File Content
            const readFile = async (path) => {
                if (isModified && !confirm("Perubahan belum disimpan. Lanjutkan tanpa simpan?")) return;
                
                const file = zip.files[path];
                if (file.dir) return;

                setSelectedPath(path);
                setLoading(true);
                try {
                    const text = await file.async("string");
                    setContent(text);
                    setIsModified(false);
                } catch (err) {
                    setContent("--- File biner atau tidak dapat dibaca sebagai teks ---");
                } finally {
                    setLoading(false);
                }
            };

            // Save individual file to ZIP object
            const saveToZip = () => {
                if (!selectedPath || !zip) return;
                zip.file(selectedPath, content);
                setIsModified(false);
                alert("Perubahan file disimpan sementara di memori.");
            };

            // Rebuild & Download APK
            const buildApk = async () => {
                if (!zip) return;
                setLoading(true);
                try {
                    const blob = await zip.generateAsync({ type: "blob" });
                    const url = URL.createObjectURL(blob);
                    const a = document.createElement("a");
                    a.href = url;
                    a.download = "modified_app.apk";
                    document.body.appendChild(a);
                    a.click();
                    document.body.removeChild(a);
                    alert("APK Berhasil Di-build! Catatan: APK ini belum ditandatangani (unsigned).");
                } catch (err) {
                    alert("Gagal membangun APK.");
                } finally {
                    setLoading(false);
                }
            };

            const filteredFiles = files.filter(f => f.toLowerCase().includes(search.toLowerCase()));

            return (
                <div className="flex flex-col h-full bg-[#0a0a0b] text-zinc-300">
                    {/* Header */}
                    <header className="h-16 border-b border-zinc-800 flex items-center justify-between px-6 bg-[#0f0f11]">
                        <div className="flex items-center gap-3">
                            <div className="p-2 bg-emerald-500/20 rounded-lg">
                                <Terminal size={20} className="text-emerald-500" />
                            </div>
                            <h1 className="font-black tracking-tighter text-xl text-white">
                                APK<span className="text-emerald-500">STUDIO</span>
                            </h1>
                        </div>

                        <div className="flex items-center gap-4">
                            <input 
                                type="file" 
                                ref={fileInputRef} 
                                className="hidden" 
                                accept=".apk,.zip" 
                                onChange={handleUpload} 
                            />
                            <button 
                                onClick={() => fileInputRef.current.click()}
                                className="flex items-center gap-2 bg-zinc-800 hover:bg-zinc-700 px-4 py-2 rounded-lg text-xs font-bold transition-all"
                            >
                                <Upload size={14} /> BUKA APK
                            </button>
                            <button 
                                onClick={buildApk}
                                disabled={!zip}
                                className="flex items-center gap-2 bg-emerald-600 hover:bg-emerald-500 disabled:opacity-50 px-4 py-2 rounded-lg text-xs font-bold text-white transition-all shadow-lg shadow-emerald-500/20"
                            >
                                <Download size={14} /> BUILD APK
                            </button>
                        </div>
                    </header>

                    <div className="flex-1 flex overflow-hidden">
                        {/* Sidebar - File Explorer */}
                        <aside className="w-80 border-r border-zinc-800 flex flex-col bg-[#0d0d0f]">
                            <div className="p-4 border-b border-zinc-800">
                                <div className="relative">
                                    <Search size={14} className="absolute left-3 top-1/2 -translate-y-1/2 text-zinc-500" />
                                    <input 
                                        type="text" 
                                        placeholder="Cari file..." 
                                        value={search}
                                        onChange={(e) => setSearch(e.target.value)}
                                        className="w-full bg-zinc-900 border border-zinc-800 rounded-md py-2 pl-9 pr-4 text-xs focus:outline-none focus:border-emerald-500"
                                    />
                                </div>
                            </div>
                            <div className="flex-1 overflow-y-auto custom-scrollbar p-2">
                                {!zip ? (
                                    <div className="h-full flex flex-col items-center justify-center text-zinc-600 p-8 text-center">
                                        <HardDrive size={40} className="mb-4 opacity-20" />
                                        <p className="text-xs">Silahkan pilih file APK untuk mulai membedah</p>
                                    </div>
                                ) : (
                                    filteredFiles.map(path => (
                                        <div 
                                            key={path}
                                            onClick={() => readFile(path)}
                                            className={`file-item flex items-center gap-3 px-3 py-2 rounded-md cursor-pointer transition-all ${selectedPath === path ? 'active' : ''}`}
                                        >
                                            {path.endsWith('/') ? <Folder size={14} className="text-amber-500" /> : <FileCode size={14} className="text-zinc-500" />}
                                            <span className="text-[11px] font-medium truncate w-full">{path}</span>
                                        </div>
                                    ))
                                )}
                            </div>
                        </aside>

                        {/* Editor Area */}
                        <main className="flex-1 flex flex-col bg-[#050506]">
                            {selectedPath ? (
                                <>
                                    <div className="h-10 border-b border-zinc-800 flex items-center justify-between px-4 bg-[#0d0d0f]">
                                        <div className="flex items-center gap-2 overflow-hidden">
                                            <File size={12} className="text-emerald-500" />
                                            <span className="text-[10px] font-bold tracking-widest text-zinc-500 uppercase truncate">{selectedPath}</span>
                                            {isModified && <span className="w-2 h-2 bg-emerald-500 rounded-full"></span>}
                                        </div>
                                        <button 
                                            onClick={saveToZip}
                                            className="flex items-center gap-1.5 text-emerald-500 hover:text-emerald-400 text-[10px] font-black uppercase tracking-widest"
                                        >
                                            <Save size={12} /> Simpan File
                                        </button>
                                    </div>
                                    <textarea 
                                        value={content}
                                        onChange={(e) => { setContent(e.target.value); setIsModified(true); }}
                                        className="flex-1 w-full bg-transparent text-emerald-100 p-6 code-font text-sm resize-none focus:outline-none custom-scrollbar"
                                        spellCheck="false"
                                    />
                                </>
                            ) : (
                                <div className="flex-1 flex flex-col items-center justify-center text-zinc-700">
                                    <Layers size={64} className="mb-6 opacity-10" />
                                    <h2 className="text-lg font-bold">Editor Kosong</h2>
                                    <p className="text-sm max-w-xs text-center mt-2 opacity-50">Pilih file dari panel kiri untuk melihat dan mengedit isinya.</p>
                                </div>
                            )}
                        </main>
                    </div>

                    {/* Footer / Status Bar */}
                    <footer className="h-8 border-t border-zinc-800 bg-[#0f0f11] flex items-center justify-between px-4 text-[10px] font-bold text-zinc-500 uppercase tracking-widest">
                        <div className="flex items-center gap-4">
                            <span className="flex items-center gap-1">
                                <Terminal size={10} /> SYSTEM READY
                            </span>
                            {loading && (
                                <span className="flex items-center gap-1 text-emerald-500">
                                    <RefreshCw size={10} className="animate-spin" /> PROCESSING...
                                </span>
                            )}
                        </div>
                        <div>
                            JSZIP ENGINE v3.10 â€¢ APK STUDIO v1.0
                        </div>
                    </footer>
                </div>
            );
        };

        const RefreshCw = ({ size, className }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M21 2v6h-6"/><path d="M3 12a9 9 0 0 1 15-6.7L21 8"/><path d="M3 22v-6h6"/><path d="M21 12a9 9 0 0 1-15 6.7L3 16"/></svg>
        );

        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>
